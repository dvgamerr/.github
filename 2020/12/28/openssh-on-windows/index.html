<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Key-based Authentication for OpenSSH on Windows &#183; Kananek T.</title><meta name=description content="Key-based Authentication for OpenSSH on Windows"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.82.0"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://touno.io/dist/site.css><link rel=stylesheet href=https://touno.io/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script type=application/javascript>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-70130307-8','auto'),ga('set','anonymizeIp',!0),ga('send','pageview'))</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://touno.io/>TOUNO.io</a></h1><a class=button-square href=https://touno.io/index.xml aria-label=RSS><i class="fa fa-rss" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=Twitter aria-label=Twitter href=https://twitter.com/dvgamerr rel=me><i class="fa fa-twitter" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=Facebook aria-label=Facebook href=https://www.facebook.com/dvgamerr rel=me><i class="fa fa-facebook" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=Github aria-label=Github href=https://github.com/dvgamerr rel=me><i class="fa fa-github-alt" aria-hidden=true></i></a></div><ul class=site-nav></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Key-based Authentication for OpenSSH on Windows</h1><p class=post-description itemprop=description>Key-based Authentication for OpenSSH on Windows</p><p class=post-date><span>Published <time datetime=2020-12-28 itemprop=datePublished>Mon, Dec 28, 2020</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://mr.touno.io itemprop=url rel=author>Kananek T.</a></span></span></p><p class="post-reading post-line"><span>Estimated reading time: 2 min</span></p></header><div class="post-content clearfix" itemprop=articleBody><p><strong>Admin Users</strong></p><p>If the user account on the server you are connecting to is in the local Administrators group, the public key must be placed in the <code>C:\ProgramData\ssh\administrators_authorized_keys</code> instead of the user&rsquo;s .ssh folder.  Additionally, only the Administrators group and SYSTEM account can have access to that file, for security purposes.  After copying your key into the file and saving it, you can use this script to set the correct permissions on it.  Here are the complete steps:</p><ol><li>Open the public key file in Notepad.  If using default path, it is <code>C:\Users\myuser\.ssh\id_rsa.pub</code></li><li>Copy the contents of the file to clipboard.  Ensure you get the entire file.</li><li>Connect to the server with Remote Desktop.</li><li>Open Notepad as administrator</li><li>In Notepad, paste in the key you copied earlier</li><li>Save the file as <code>C:\ProgramData\ssh\administrators_authorized_keys</code> with no extension.  You may need to make file extensions visible to ensure you can remove the .txt extension.</li><li>Use the below PowerShell script to set the correct permissions on the file</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-powershell data-lang=powershell>$acl = Get-Acl C:\ProgramData\ssh\administrators_authorized_keys
$acl.SetAccessRuleProtection($true, $false)
$administratorsRule = New-Object system.security.accesscontrol.filesystemaccessrule(<span style=color:#e6db74>&#34;Administrators&#34;</span>,<span style=color:#e6db74>&#34;FullControl&#34;</span>,<span style=color:#e6db74>&#34;Allow&#34;</span>)
$systemRule = New-Object system.security.accesscontrol.filesystemaccessrule(<span style=color:#e6db74>&#34;SYSTEM&#34;</span>,<span style=color:#e6db74>&#34;FullControl&#34;</span>,<span style=color:#e6db74>&#34;Allow&#34;</span>)
$acl.SetAccessRule($administratorsRule)
$acl.SetAccessRule($systemRule)
$acl | Set-Acl
</code></pre></div><p>If you don&rsquo;t do this, and instead only place the file in the .ssh folder for the user, you&rsquo;ll either get prompted for your password (instead of using the key file), or your connection will fail with &ldquo;Too many authentication attempts&rdquo;.</p><p>REF: <a href=https://www.concurrency.com/blog/may-2019/key-based-authentication-for-openssh-on-windows>https://www.concurrency.com/blog/may-2019/key-based-authentication-for-openssh-on-windows</a></p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/tags/mongo/>mongo</a>,
<a href=/tags/user/>user</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=Key-based%20Authentication%20for%20OpenSSH%20on%20Windows&url=https%3a%2f%2ftouno.io%2f2020%2f12%2f28%2fopenssh-on-windows%2f" onclick="return window.open(this.href,'twitter-share','width=550,height=235'),!1" aria-label="Share on Twitter"><i class="fa fa-twitter" aria-hidden=true></i></a>
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftouno.io%2f2020%2f12%2f28%2fopenssh-on-windows%2f" onclick="return window.open(this.href,'facebook-share','width=580,height=296'),!1" aria-label="Share on Facebook"><i class="fa fa-facebook" aria-hidden=true></i></a></div></footer></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://touno.io/>TOUNO.io</a></h1><a class="button-square button-jump-top js-jump-top" href=# aria-label="Back to Top"><i class="fa fa-angle-up" aria-hidden=true></i></a></div><p class=footer-copyright><span>&copy; 2021 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=https://touno.io/js/jquery-1.11.3.min.js></script><script src=https://touno.io/js/jquery.fitvids.js></script><script src=https://touno.io/js/scripts.js></script></body></html>